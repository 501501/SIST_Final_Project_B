<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.sist.b.post.PostRepository">
  
  <!-- post upload -->
  	<insert id="setPostUpload" parameterType="PostVO" useGeneratedKeys="true" keyProperty="postNum">
  		INSERT INTO 
  				post
  		VALUES
  				(#{postNum}, #{userNum}, #{contents}, #{tag, jdbcType=VARCHAR}, now(), 0)
  	</insert>
  	
  <!-- post List -->	
	
	<resultMap type="PostVO" id="selectResult">
		<id column="postNum" property="postNum"/>
		<result column="userNum" property="userNum"/>
		<result column="contents" property="contents"/>
		<result column="tag" property="tag"/>
		<result column="regDate" property="regDate"/>
		<result column="likes" property="likes"/>
		
		<association property="userVO" javaType="UserVO">
			<result column="nickname" property="nickname"/>
			<result column="fileName" property="fileName"/>
			<result column="username" property="username"/>
		</association>
		
		<association property="likesVO" javaType="LikesVO">
			<result column="likesNum" property="likesNum"/>
			<result column="postNum" property="postNum"/>
			<result column="userNum" property="userNum"/>
		
		</association>
		
		<collection property="fileList" javaType="List" ofType="PostFilesVO">
			<id column="fileNum" property="fileNum"/>
			<result column="postNum" property="postNum"/>
			<result column="postfileName" property="postfileName"/>
			<result column="oriName" property="oriName"/>
		</collection>
		
		
	
	</resultMap>
	
		<select id="getPostList" resultMap="selectResult">
  		SELECT * 
  		FROM post
  		LEFT JOIN user
  		USING(userNum)
  		LEFT JOIN likes
  		USING(postNum)
  		LEFT JOIN postfiles 
  		USING(postNum)
  		ORDER BY postNum DESC
  	</select>
  	
  <!-- select post -->
  	<select id="getUserPost" parameterType="PostVO" resultMap="selectResult">
  		SELECT * 
  		FROM post
  		LEFT JOIN user
  		USING(userNum)
  		LEFT JOIN likes
  		USING(postNum)
  		LEFT JOIN postfiles
  		USING(postNum)
  		WHERE postNum = #{postNum}
  	
  	</select>
  	
  	<!-- delete post -->
  	<delete id="setDeletePost" parameterType="PostVO">
  		DELETE
  		FROM post
  		WHERE postNum = #{postNum}
  	</delete>
  	
  
  <!-- file upload -->
  	<insert id="setFilesInsert" parameterType="PostFilesVO">
  		INSERT INTO postFiles
  		VALUES (null, #{postNum}, #{postfileName}, #{oriName})
  	</insert>
  	
 
  </mapper>